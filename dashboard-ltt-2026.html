<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard LTT 2026</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:Segoe UI,Arial;
  background:#f3f6fb;
  padding:20px;
}
h1{text-align:center;margin-bottom:20px;}

.dashboard{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
  margin-bottom:30px;
}

.card{
  background:#fff;
  padding:20px;
  border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

.filters{
  display:flex;
  gap:10px;
  margin-bottom:15px;
}

select{
  padding:8px 12px;
  border-radius:8px;
  border:1px solid #ccc;
}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

th,td{
  padding:10px;
  border-bottom:1px solid #eee;
  text-align:center;
}

th{
  background:#0f6fff;
  color:#fff;
}
</style>
</head>
<body>

<h1>ðŸ“Š Dashboard LTT 2026</h1>

<div class="dashboard">
  <div class="card">
    <canvas id="chartTanggal"></canvas>
  </div>
  <div class="card">
    <canvas id="chartKecamatan"></canvas>
  </div>
</div>

<div class="filters">
  <select id="filterKecamatan"></select>
  <select id="filterDesa"></select>
  <select id="filterTanggal"></select>
</div>

<table id="data-table"></table>

<script>
const csvUrl="PASTE_URL_CSV_KAMU_DI_SINI";

let rawData=[],headers=[];

async function loadCSV(){
  const res=await fetch(csvUrl);
  const text=await res.text();
  const rows=text.trim().split("\n").map(r=>r.split(","));
  headers=rows[0];
  rawData=rows.slice(1);
  buildFilters();
  renderAll(rawData);
}

function buildFilters(){
  fillSelect("filterKecamatan",2);
  fillSelect("filterTanggal",3);
  fillSelect("filterDesa",4);
}

function fillSelect(id,col){
  const s=document.getElementById(id);
  const vals=[...new Set(rawData.map(r=>r[col]))];
  s.innerHTML=`<option value="">Semua</option>`+
    vals.map(v=>`<option>${v}</option>`).join("");
  s.onchange=applyFilter;
}

function applyFilter(){
  let data=[...rawData];
  const fKec=filterKecamatan.value;
  const fDes=filterDesa.value;
  const fTgl=filterTanggal.value;

  if(fKec) data=data.filter(r=>r[2]==fKec);
  if(fDes) data=data.filter(r=>r[4]==fDes);
  if(fTgl) data=data.filter(r=>r[3]==fTgl);

  renderAll(data);
}

function renderAll(data){
  renderTable(data);
  renderChartTanggal(data);
  renderChartKecamatan(data);
}

function renderTable(data){
  let html="<thead><tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"</tr></thead><tbody>";
  data.forEach(r=>{
    html+="<tr>"+r.map(c=>`<td>${c}</td>`).join("")+"</tr>";
  });
  html+="</tbody>";
  document.getElementById("data-table").innerHTML=html;
}

function sumBy(colLabel){
  const map={};
  rawData.forEach(r=>{
    const k=r[colLabel];
    map[k]=(map[k]||0)+parseFloat(r[6]||0);
  });
  return map;
}

function renderChartTanggal(data){
  const map={};
  data.forEach(r=>{
    map[r[3]]=(map[r[3]]||0)+parseFloat(r[6]||0);
  });

  drawChart("chartTanggal",Object.keys(map),Object.values(map),"LTT per Tanggal");
}

function renderChartKecamatan(data){
  const map={};
  data.forEach(r=>{
    map[r[2]]=(map[r[2]]||0)+parseFloat(r[6]||0);
  });

  drawChart("chartKecamatan",Object.keys(map),Object.values(map),"LTT per Kecamatan");
}

function drawChart(id,labels,values,title){
  const ctx=document.getElementById(id);
  if(ctx.chart) ctx.chart.destroy();

  ctx.chart=new Chart(ctx,{
    type:'bar',
    data:{
      labels:labels,
      datasets:[{
        label:title,
        data:values
      }]
    },
    options:{responsive:true}
  });
}

loadCSV();
setInterval(loadCSV,60000);
</script>
</body>
</html>
