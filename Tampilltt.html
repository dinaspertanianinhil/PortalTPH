<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard LTT 2026</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{
font-family:Segoe UI;
margin:0;
background:url("https://png.pngtree.com/thumb_back/fh260/background/20240705/pngtree-view-of-green-rice-fields-with-morning-dew-and-mountains-with-image_15859864.jpg") no-repeat center center fixed;
background-size:cover;
}

.overlay{
background:rgba(255,255,255,0.9);
min-height:100vh;
padding:20px;
}

header{
display:flex;
align-items:center;
gap:15px;
margin-bottom:20px;
}

header img{
width:70px;
background:white;
border-radius:12px;
padding:5px;
}

.title{
font-size:22px;
font-weight:700;
color:#1b4332;
}

.subtitle{
font-size:14px;
color:#555;
}

.score{
background:#2d6a4f;
color:white;
padding:15px;
border-radius:10px;
text-align:center;
font-size:20px;
margin-bottom:20px;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
gap:15px;
align-items:start;
}

.card{
background:white;
padding:15px;
border-radius:12px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.menu{
display:flex;
gap:10px;
flex-wrap:wrap;
margin-bottom:15px;
}

.menu button{
background:#2d6a4f;
border:none;
color:white;
padding:6px 12px;
border-radius:6px;
cursor:pointer;
}

.menu button.active{
background:#1b4332;
}

table{
width:100%;
border-collapse:collapse;
font-size:13px;
}

th{
background:#2d6a4f;
color:white;
padding:6px;
}

td{
border-bottom:1px solid #ddd;
padding:6px;
}

.action{
margin-bottom:10px;
}

.action button{
background:#2d6a4f;
color:white;
border:none;
padding:5px 10px;
border-radius:5px;
cursor:pointer;
margin-right:5px;
}
</style>
</head>

<body>

<div class="overlay">

<header>
<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTQvtMhMi3IPSaJOTLYIUlxiX4QMMFIfonoCA&s">
<div>
<div class="title">Bidang Tanaman Pangan dan Hortikultura</div>
<div class="subtitle">Dashboard LTT 2026</div>
</div>
</header>

<div class="score" id="totalLTT">Memuat data...</div>

<div class="grid">

<div class="card">
<h3>Grafik LTT</h3>
<canvas id="chartLTT"></canvas>
</div>

<div class="card">
<h3>Data Rekap</h3>

<div class="menu">
<button onclick="gantiRekap('jenis')" class="active">Jenis LTT</button>
<button onclick="gantiRekap('kecamatan')">Kecamatan</button>
<button onclick="gantiRekap('desa')">Desa</button>
<button onclick="gantiRekap('poktan')">Poktan</button>
</div>

<div class="action">
<button onclick="downloadExcel()">Excel</button>
<button onclick="downloadPDF()">PDF</button>
</div>

<div id="tabelData">Memuat...</div>

</div>

</div>
</div>

<script>
const url="https://script.google.com/macros/s/AKfycbzmAikwGmp7Psfqd0bUNcqvdG61HzoBd7glssY6LKH2TJgOOYHHZ-jVFUMSWVVaaZQN/exec";
let dataGlobal={};
let mode="jenis";

async function loadData(){
const res=await fetch(url);
dataGlobal=await res.json();

document.getElementById("totalLTT").innerText=
"Total LTT Kabupaten : "+dataGlobal.total+" Ha";

buatGrafik();
renderTabel();
}

function buatGrafik(){
const ctx=document.getElementById("chartLTT");

new Chart(ctx,{
type:"bar",
data:{
labels:dataGlobal.jenis.map(d=>d.nama),
datasets:[{
label:"Luas",
data:dataGlobal.jenis.map(d=>d.luas)
}]
}
});
}

function gantiRekap(m){
mode=m;

document.querySelectorAll(".menu button")
.forEach(b=>b.classList.remove("active"));

event.target.classList.add("active");

renderTabel();
}

function renderTabel(){
let data=dataGlobal[mode];

let html="<table><tr><th>Nama</th><th>Luas</th></tr>";

data.forEach(d=>{
html+=`<tr>
<td>${d.nama}</td>
<td>${d.luas} Ha</td>
</tr>`;
});

html+="</table>";

document.getElementById("tabelData").innerHTML=html;
}

function downloadExcel(){
let data=dataGlobal[mode];
let rows=[["Nama","Luas"]];

data.forEach(d=>rows.push([d.nama,d.luas]));

const ws=XLSX.utils.aoa_to_sheet(rows);
const wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Rekap");
XLSX.writeFile(wb,"rekap_ltt.xlsx");
}

function downloadPDF(){
window.print();
}

loadData();
</script>

</body>
</html>
