<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard LTT</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:Segoe UI,Arial;
background:url("https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvxh4_NzxPObs3auPYoJIUojZJvrn6v1Akhw&s");
background-size:cover;
background-attachment:fixed;
color:white;
}

.overlay{
background:rgba(0,60,30,0.85);
min-height:100vh;
}

header{
display:flex;
align-items:center;
gap:15px;
padding:15px 25px;
background:linear-gradient(90deg,#0f5132,#0b3d2e);
box-shadow:0 4px 20px rgba(0,0,0,0.3);
}

.logo{
height:55px;
background:white;
padding:6px;
border-radius:10px;
}

.title{
font-size:20px;
font-weight:600;
}

nav{
display:flex;
gap:20px;
padding:10px 25px;
background:#0b3d2e;
position:sticky;
top:0;
z-index:10;
}

.menu{
position:relative;
cursor:pointer;
}

.menu:hover .submenu{
display:block;
}

.submenu{
display:none;
position:absolute;
top:30px;
background:#0f5132;
padding:10px;
border-radius:10px;
box-shadow:0 10px 25px rgba(0,0,0,0.4);
}

.submenu div{
padding:8px 15px;
white-space:nowrap;
}

.submenu div:hover{
background:#198754;
border-radius:6px;
}

.container{
padding:25px;
}

.grid{
display:flex;
gap:20px;
overflow-x:auto;
}

.card{
min-width:420px;
background:rgba(0,0,0,0.25);
backdrop-filter:blur(10px);
border-radius:20px;
padding:20px;
box-shadow:0 10px 40px rgba(0,0,0,0.4);
}

.card h2{
margin-top:0;
}

canvas{
background:rgba(255,255,255,0.03);
border-radius:10px;
padding:10px;
}

@media(max-width:768px){
.card{
min-width:350px;
}
}
</style>
</head>

<body>

<div class="overlay">

<header>
<img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/a/a3/Logo_kabupaten_indragiri_hilir.jpg">
<div class="title">
Bidang Tanaman Pangan dan Hortikultura<br>
Dinas Pertanian Kabupaten Indragiri Hilir
</div>
</header>

<nav>
<div class="menu">Dashboard</div>

<div class="menu">
Rekap Jenis LTT
<div class="submenu">
<div>Kabupaten</div>
<div>Kecamatan</div>
<div>Desa</div>
</div>
</div>

<div class="menu">
Rekap Bulanan
<div class="submenu">
<div>Kabupaten</div>
<div>Kecamatan</div>
<div>Desa</div>
</div>
</div>

<div class="menu">
Rekap Musiman
<div class="submenu">
<div>Kabupaten</div>
<div>Kecamatan</div>
<div>Desa</div>
</div>
</div>

</nav>

<div class="container">

<div class="grid">

<div class="card">
<h2>Grafik Jenis LTT</h2>
<canvas id="chartJenis"></canvas>
</div>

<div class="card">
<h2>Ranking Kecamatan</h2>
<canvas id="chartKecamatan"></canvas>
</div>

<div class="card">
<h2>Rekap Bulanan</h2>
<canvas id="chartBulanan"></canvas>
</div>

</div>

</div>
</div>

<script>

const urlAPI="https://script.google.com/macros/s/AKfycby2-GIC6Rx_atSv-Y65VjJedMMYhbJFuI_qYMrvFgWXzdWME8yrfnsIsU1bsvsDtgHg/exec";

async function loadData(){
const res=await fetch(urlAPI);
const result=await res.json();
const data=result.data || result;

olahData(data);
}

function olahData(data){

let jenis={};
let kecamatan={};
let bulan={};

data.forEach(d=>{

let luas=Number(d["LUAS TAMBAH TANAM"] || d["LUAS_TAMBAH_TANAM"])||0;
let jenisLTT=d["JENIS LTT"];
let kec=d["KECAMATAN"];
let tanggal=new Date(d["TANGGAL"]);
let bln=tanggal.toLocaleString("id-ID",{month:"short"});

if(!jenis[jenisLTT]) jenis[jenisLTT]=0;
jenis[jenisLTT]+=luas;

if(!kecamatan[kec]) kecamatan[kec]=0;
kecamatan[kec]+=luas;

if(!bulan[bln]) bulan[bln]=0;
bulan[bln]+=luas;

});

buatChart("chartJenis",jenis);
buatChart("chartKecamatan",kecamatan);
buatChart("chartBulanan",bulan);
}

function buatChart(id,data){

new Chart(document.getElementById(id),{
type:"bar",
data:{
labels:Object.keys(data),
datasets:[{
data:Object.values(data),
borderWidth:1
}]
},
options:{
plugins:{
legend:{display:false}
},
scales:{
y:{beginAtZero:true}
}
}
});

}

loadData();

</script>

</body>
</html>
