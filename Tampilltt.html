<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard LTT Kabupaten</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>

body{
font-family:Segoe UI;
margin:0;
padding:20px;
background-image:url("https://png.pngtree.com/thumb_back/fh260/background/20240731/pngtree-beautiful-landscape-of-a-rice-field-and-sky-in-the-village-image_15937834.jpg");
background-size:cover;
background-position:center;
background-attachment:fixed;
}

body::before{
content:"";
position:fixed;
top:0;
left:0;
right:0;
bottom:0;
background:rgba(255,255,255,0.88);
z-index:-1;
}

.header{
display:flex;
align-items:center;
gap:15px;
margin-bottom:20px;
}

.logo{
width:70px;
}

.judul{
font-size:22px;
font-weight:600;
}

/* MENU DASHBOARD */

.menu-dashboard{
display:flex;
gap:10px;
flex-wrap:wrap;
margin-bottom:20px;
}

.menu-dashboard button{
background:#2d6a4f;
border:none;
color:white;
padding:10px 16px;
border-radius:8px;
cursor:pointer;
font-weight:600;
}

.menu-dashboard button:hover{
background:#1b4332;
}

.dropdown{
position:relative;
}

.dropdown-content{
display:none;
position:absolute;
background:white;
min-width:200px;
box-shadow:0 4px 10px rgba(0,0,0,0.15);
border-radius:8px;
overflow:hidden;
z-index:99;
}

.dropdown-content button{
width:100%;
border:none;
background:white;
padding:10px;
text-align:left;
cursor:pointer;
color:#333;
}

.dropdown-content button:hover{
background:#f1f1f1;
}

.dropdown:hover .dropdown-content{
display:block;
}

/* GRID */

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
gap:15px;
}

.card{
background:white;
padding:15px;
border-radius:12px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.card h3{
margin-top:0;
}

table{
width:100%;
border-collapse:collapse;
}

th{
background:#2d6a4f;
color:white;
padding:6px;
}

td{
padding:6px;
border-bottom:1px solid #ddd;
text-align:center;
}

</style>
</head>

<body>

<div id="dashboard">

<div class="header">
<img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/a/a3/Logo_kabupaten_indragiri_hilir.jpg">
<div class="judul">Dashboard Monitoring LTT Kabupaten</div>
</div>

<!-- MENU UTAMA -->
<div class="menu-dashboard">

<div class="dropdown">
<button>Rekap Jenis LTT</button>
<div class="dropdown-content">
<button onclick="mode='jenis_total';render()">Kabupaten</button>
<button onclick="mode='jenis_kecamatan';render()">Per Kecamatan</button>
<button onclick="mode='jenis_desa';render()">Per Desa</button>
</div>
</div>

<div class="dropdown">
<button>Rekap Perbulan</button>
<div class="dropdown-content">
<button onclick="mode='bulan_kab';render()">Kabupaten</button>
<button onclick="mode='bulan_kec';render()">Kecamatan</button>
<button onclick="mode='bulan_desa';render()">Desa</button>
</div>
</div>

<div class="dropdown">
<button>Rekap Permusim</button>
<div class="dropdown-content">
<button onclick="mode='musim_kab';render()">Kabupaten</button>
<button onclick="mode='musim_kec';render()">Kecamatan</button>
<button onclick="mode='musim_desa';render()">Desa</button>
</div>
</div>

<button onclick="downloadExcel()">Download Excel</button>
<button onclick="downloadPDF()">Download PDF</button>

</div>

<div class="grid">

<div class="card">
<h3>Grafik Jenis LTT</h3>
<canvas id="chartJenis"></canvas>
</div>

<div class="card">
<h3>Ranking Kecamatan</h3>
<canvas id="chartKecamatan"></canvas>
</div>

<div class="card">
<h3>Papan Skor Realisasi LTT (Live)</h3>
<div id="liveScore"></div>
</div>

<div class="card" style="grid-column:1/-1">
<h3>Rekap Data</h3>
<div id="tabel">Memuat...</div>
</div>

</div>

</div>

<script>

const url="https://script.google.com/macros/s/AKfycby2-GIC6Rx_atSv-Y65VjJedMMYhbJFuI_qYMrvFgWXzdWME8yrfnsIsU1bsvsDtgHg/exec";

let DATA;
let mode="jenis_total";
let chartStore={};

async function load(){

const res=await fetch(url);
DATA=await res.json();

buatGrafik("chartJenis",DATA.jenis_total);
buatGrafik("chartKecamatan",DATA.kecamatan_total);

papanSkor();
render();

}

/* GRAFIK */

function buatGrafik(id,data){

if(!data) return;

const label=Object.keys(data);
const nilai=Object.values(data);

if(chartStore[id]){
chartStore[id].destroy();
}

chartStore[id]=new Chart(document.getElementById(id),{
type:"bar",
data:{
labels:label,
datasets:[{data:nilai}]
},
options:{
responsive:true,
plugins:{legend:{display:false}}
}
});

}

/* PAPAN SKOR LIVE */

function papanSkor(){

let html="<table>";
html+="<tr><th>Ranking</th><th>Kecamatan</th><th>LTT</th></tr>";

let sorted = Object.entries(DATA.kecamatan_total)
.sort((a,b)=>b[1]-a[1]);

sorted.forEach((row,i)=>{
html+=`<tr>
<td>${i+1}</td>
<td>${row[0]}</td>
<td>${row[1]}</td>
</tr>`;
});

html+="</table>";

document.getElementById("liveScore").innerHTML=html;

}

/* TABEL REKAP */

function render(){

let html="<table>";

if(mode==="jenis_total"){
html+="<tr><th>Jenis</th><th>Luas</th></tr>";
for(let i in DATA.jenis_total){
html+=`<tr><td>${i}</td><td>${DATA.jenis_total[i]}</td></tr>`;
}
}

if(mode==="jenis_kecamatan"){
html+="<tr><th>Kecamatan</th><th>Luas</th></tr>";
for(let i in DATA.kecamatan_total){
html+=`<tr><td>${i}</td><td>${DATA.kecamatan_total[i]}</td></tr>`;
}
}

if(mode==="jenis_desa"){
html+="<tr><th>Desa</th><th>Luas</th></tr>";
for(let i in DATA.desa_total){
html+=`<tr><td>${i}</td><td>${DATA.desa_total[i]}</td></tr>`;
}
}

if(mode==="bulan_kab" || mode==="bulan_kec" || mode==="bulan_desa"){
html+="<tr><th>Bulan Berjalan</th><th>Total LTT</th></tr>";
提醒
html+=`<tr><td>Realisasi</td><td>${DATA.total_kabupaten}</td></tr>`;
}

if(mode==="musim_kab" || mode==="musim_kec" || mode==="musim_desa"){
html+="<tr><th>Musim Berjalan</th><th>Total LTT</th></tr>";
html+=`<tr><td>Realisasi</td><td>${DATA.total_kabupaten}</td></tr>`;
}

html+="</table>";

document.getElementById("tabel").innerHTML=html;

}

/* DOWNLOAD */

function downloadExcel(){
let wb=XLSX.utils.book_new();
let table=document.querySelector("table");
let ws=XLSX.utils.table_to_sheet(table);
XLSX.utils.book_append_sheet(wb,ws,"Rekap");
XLSX.writeFile(wb,"rekap_ltt.xlsx");
}

async function downloadPDF(){

const element=document.getElementById("dashboard");
const canvas=await html2canvas(element);
const img=canvas.toDataURL("image/png");

const { jsPDF } = window.jspdf;
const pdf=new jsPDF("l","mm","a4");

pdf.addImage(img,"PNG",5,5,287,200);
pdf.save("dashboard_ltt.pdf");

}

load();

</script>

</body>
</html>
